LET EventData := input();

LET SqrlMutate := true;

LET ActionName := jsonValue(EventData, '$.name');
LET Ip := jsonNode('Ip', EventData, '$.ip');

LET IsSignup := ActionName IN ["signup", "new_account"];

CREATE RULE SignupRateLimit
  WHERE rateLimited(BY Ip MAX 3 EVERY 30 SECONDS WHERE IsSignup);
WHEN SignupRateLimit 
  BLOCK ACTION
  ADD "rate_limited" TO Ip;
